# ====================================================================
# MPV CONFIGURATION (Terrormonkey / Kwaery)
# ====================================================================

# --- GENERAL BEHAVIOR ---
keep-open=yes
save-position-on-quit=yes
force-window=immediate
cursor-autohide=2000
script-opts=osc-hidetimeout=2000,script-opts=osc-windowcontrols=no

# --- VIDEO QUALITY & RENDERER ---
profile=high-quality
vo=gpu-next
gpu-api=d3d11           # Best choice for Windows
hwdec=auto-safe         # Uses hardware decoding when available

# --- UPSCALING (High-End) ---
# ewa_lanczos is excellent, tuned for sharpness (similar to 'lanczossharp')
scale=ewa_lanczos
scale-blur=0.981251     # Mathematically ideal sharpness value
# Chroma upscaling also high-quality (fine for modern GPUs)
cscale=ewa_lanczos
dscale=mitchell         # Good for downscaling
sigmoid-upscaling=yes
linear-downscaling=no

# --- COLORS, DITHERING & HDR ---
# "error-diffusion" is higher quality than "fruit", but more intensive (peak!)
dither-depth=auto
dither=error-diffusion
error-diffusion=floyd-steinberg

deband=yes
deband-iterations=2     # 2 is balanced, 4 is too aggressive for fine details
deband-threshold=35
deband-range=20         # Slightly increased for better coverage
deband-grain=5          # IMPORTANT: Preserves texture, prevents "plastic" look

target-colorspace-hint=yes
hdr-compute-peak=yes
tone-mapping=spline

# --- SMOOTH MOTION ---
video-sync=display-resample
interpolation=yes
tscale=oversample

# --- SUBTITLES (Anime Optimized) ---
blend-subtitles=no      # Disabled for SubsPlease/Signs! Prevents scaling issues at 1080p -> 4K
sub-fix-timing=no

# IMPORTANT FOR ANIME SIGNS:
sub-use-margins=no      # Renders subs on the video, not on black bars
sub-ass-force-margins=no # Prevents signs from being displaced
sub-ass-override=no     # Fully respects fansub group styling

sub-font='Inter Medium'
sub-font-size=44
sub-color='#FFFFFF'
sub-border-size=2.5
sub-border-color='#000000'
sub-margin-y=40
sub-shadow-offset=0
sub-blur=1.5
sub-auto=fuzzy

# --- AUDIO ---
ao=wasapi
audio-exclusive=no
audio-channels=auto-safe
audio-pitch-correction=yes
volume-max=200

# --- GEOMETRY & OSD ---
keepaspect-window=yes
autofit-larger=90%x90%
osd-font='Inter Medium'
osd-font-size=30
osd-border-size=1.5
osd-color='#FFFFFF'
osd-back-color='#80000000'

# --- SCREENSHOTS ---
screenshot-format=png
screenshot-high-bit-depth=yes
screenshot-png-compression=7
screenshot-template='~/Desktop/mpv-%F-%p-%n'

# --- CACHE ---
cache=yes
demuxer-max-bytes=800MiB      # Doubled for 4K content
demuxer-max-back-bytes=200MiB

# --- LANGUAGE PREFERENCES ---
# Audio: Japanese preferred, fallback to English/German
alang=ja,jp,jpn,en,eng,de,ger
# Subtitles: German preferred, then English
slang=de,ger,en,eng
